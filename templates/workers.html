{% extends "base.html" %}

{% block content %}
<div class="container mx-auto p-4">
    <!-- Search Form -->
    <div class="mb-4">
        <form method="GET" action="{{ url_for('workers') }}" class="flex justify-center">
            <input type="text" name="search" placeholder="ძებნა..."
                class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
            <button type="submit"
                class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline ml-2">
                ძებნა
                <svg class="w-4 h-4 inline-block ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M21 21l-4.35-4.35M17 10A7 7 0 1 1 3 10a7 7 0 0 1 14 0z">
                    </path>
                </svg>
            </button>
        </form>
    </div>

    <!-- Add Post Form -->
    <div class="mb-4">
        <form method="POST" action="{{ url_for('workers') }}" class="add_post_form" enctype="multipart/form-data">
            {{ form.hidden_tag() }}
            <div class="pr-4">
                {{ form.name.label(class="block text-gray-700 text-sm font-bold mb-2") }}
                {{ form.name(class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight
                focus:outline-none focus:shadow-outline") }}
            </div>
            <div class="pr-4">
                {{ form.surname.label(class="block text-gray-700 text-sm font-bold mb-2") }}
                {{ form.surname(class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700
                leading-tight focus:outline-none focus:shadow-outline") }}
            </div>
            <div class="pr-4">
                {{ form.title.label(class="block text-gray-700 text-sm font-bold mb-2") }}
                {{ form.title(class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight
                focus:outline-none focus:shadow-outline") }}
            </div>
            <div class="pr-4">
                {{ form.content.label(class="block text-gray-700 text-sm font-bold mb-2") }}
                {{ form.content(class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700
                leading-tight focus:outline-none focus:shadow-outline") }}
            </div>
            <div class="pr-4">
                {{ form.photo.label(class="block text-gray-700 text-sm font-bold mb-2") }}
                {{ form.photo(class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight
                focus:outline-none focus:shadow-outline") }}
            </div>
            <div class="flex items-center justify-between submit_button">
                {{ form.submit(class="bg-blue-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded
                focus:outline-none focus:shadow-outline") }}
            </div>
        </form>
    </div>

    <!-- Posts Table -->
    <div class="overflow-x-auto">
        <table class="min-w-full bg-white border border-gray-200 rounded-lg shadow-md">
            <thead>
                <tr class="bg-gray-200 text-gray-700">
                    <th class="px-4 py-2 border-b text-left">სახელი</th>
                    <th class="px-4 py-2 border-b text-left">გვარი</th>
                    <th class="px-4 py-2 border-b text-left">სათაური</th>
                    <th class="px-4 py-2 border-b text-left">აღწერა</th>
                    <th class="px-4 py-2 border-b text-left">ფოტო</th>
                    <th class="px-4 py-2 border-b text-left">ავტორი</th>
                    <th class="px-4 py-2 border-b text-left">ქმედებები</th>
                </tr>
            </thead>
            <tbody>
                {% for post in posts %}
                <tr class="hover:bg-gray-100">
                    <td class="px-4 py-2 border-b">
                        {% if post.photo %}
                        <img src="{{ url_for('static', filename='uploads/' ~ post.photo) }}" class="post-image" alt="Post Photo"
                            width="100">
                        {% else %}
                        No Photo
                        {% endif %}
                    </td>
                    <td class="px-4 py-2 border-b">{{ post.name }}</td>
                    <td class="px-4 py-2 border-b">{{ post.surname }}</td>
                    <td class="px-4 py-2 border-b">{{ post.title }}</td>
                    <td class="px-4 py-2 border-b">{{ post.content }}</td>
                    <td class="px-4 py-2 border-b">{{ post.author.username }}</td>
                    <td class="px-4 py-2 border-b">
                        {% if post.author.username == session['username'] or session.get('is_admin') %}
                        <form method="POST" action="{{ url_for('delete_post', post_id=post.id) }}">
                            <button type="submit"
                                class="bg-red-500 hover:bg-red-700 text-white font-bold py-1 px-3 rounded">წაშლა</button>
                        </form>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}